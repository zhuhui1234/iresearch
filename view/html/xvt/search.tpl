<!DOCTYPE html>
<html lang="utf-8">

<head>
    <meta charset="utf-8">
    <title>艾瑞数据 - 数据改变认知 提升企业效能</title>
    <meta name="keywords" content="艾瑞数据,艾瑞指数,艾瑞睿见,艾瑞智云">
    <meta name="description"
          content="艾瑞数据，是艾瑞互联网大数据服务平台，基于15年互联网的研究积累，致力于数据改变认知、提升企业效能，为客户提供基于情报+数据+服务的多元化大数据解决方案，服务涵盖市场竞争监测、消费者洞察、营销决策、企业精细化运营及数据共享等业务。">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"/>
    <meta name="viewport"
          content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
    <script>
        (function (doc, win) {
            var docEl = doc.documentElement,
                resizeEvt = 'orientationchange' in window ? 'orientationchange' : 'resize',
                recalc = function () {
                    var clientWidth = docEl.clientWidth;
                    if (!clientWidth) return;
                    var _FS = 100 * (clientWidth / 750);
                    if (_FS > 100) _FS = 100;
                    docEl.style.fontSize = _FS + 'px';
                };

            if (!doc.addEventListener) return;
            win.addEventListener(resizeEvt, recalc, false);
            doc.addEventListener('DOMContentLoaded', recalc, false);
        })(document, window);
    </script>
    <link rel="shortcut icon" href="http://data.iresearch.com.cn/images/favicon.ico"
          mce_href="http://data.iresearch.com.cn/images/favicon.ico"
          type="image/x-icon">
    <link rel="stylesheet" href="http://data.iresearch.com.cn/css/bootstrap.min.css"/>
    <link href="https://cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet">
    <link rel="stylesheet" href="public/css/xvt/header.css"/>
    <link rel="stylesheet" href="public/css/xvt/search.css"/>
</head>

<body>
<div class="Topbar">
    <div class="container">
        <div class="links"><a href="http://group.iresearch.com.cn/" target="_blank">艾瑞集团</a>|<a
                    href="http://www.iresearch.com.cn/" target="_blank">艾瑞咨询</a>|
            <a href="http://data.iresearch.com.cn/" target="_blank">艾瑞数据</a>|<a href="http://capital.iresearch.com.cn/"
                                                                                target="_blank">艾瑞资本</a> |
            <a href="http://www.iresearch.cn/" target="_blank">艾瑞网</a>|<a href="http://events.iresearch.cn/"
                                                                          target="_blank">艾瑞活动</a>|
            <a href="http://www.iresearchchina.com/" target="_blank">English</a>
        </div>
    </div>
</div>

<!--导航-->
<nav class="navbar navbar-default" id="nav">
    <div class="container">
        <button type="button" class="navbar-toggle">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
        </button>
        <h2 class="hd-title-mobile">艾瑞数据</h2>
        <div class="collapse navbar-collapse" id="navbar-collapse">
            <div class="mobele-logo">
                <a href="Home.shtml"><img src="http://data.iresearch.com.cn/images/logo.png"></a>
            </div>
            <div class="btn-box">
                <span class="loginReg"><a href="javascript:;"><i class="login"></i><em>登录</em></a><a
                            href="javascript:;"><i class="reg"></i><em>注册</em></a></span>
            </div>
            <ul class="nav navbar-nav navbar-left">
                <li id="n_1"><a href="//data.iresearch.com.cn/Home.shtml"><span>首页</span><em>Home</em></a></li>
                <li id="n_2" role="presentation" class="dropdown ">
                    <a href="//data.iresearch.com.cn/Home.shtml" class="dropdown-toggle"><span>艾瑞指数</span><em>iRIndex</em></a>
                    <div class="dropdown-menu-box">
                        <ul class="dropdown-menu">
                            <li><a href="http://index.iresearch.com.cn/app"><i
                                            class="icon icon-app"></i><span>APP 指数</span><em>Mobile User Behavior
                                        Insight</em></a></li>
                            <li><a href="http://index.iresearch.com.cn/pc"><i
                                            class="icon icon-pc"></i><span>PC 指数</span><em>Web User Behavior
                                        Insight</em></a></li>
                            <li><a href="http://index.iresearch.com.cn/Video/"><i class="icon icon-video"></i><span>影视 指数</span><em>Network
                                        Video Market Monitoring</em></a></li>
                        </ul>
                    </div>
                </li>
                <li id="n_3" role="presentation" class="dropdown">
                    <a href="//data.iresearch.com.cn/iRView.shtml" class="dropdown-toggle"><span>艾瑞睿见</span><em>iRView</em></a>
                    <div class="dropdown-menu-box">
                        <ul class="dropdown-menu">
                            <li><a href="http://irv.iresearch.com.cn/iResearchDataWeb/?m=user&a=jump&pro=11"
                                   target="_blank"><i class="icon icon-iRView-1"></i><em>xMediaPlanner</em><span>跨屏媒介效果评估</span></a>
                            </li>
                            <li><a href="http://irv.iresearch.com.cn/iResearchDataWeb/?m=user&a=jump&pro=18"
                                   target="_blank"><i class="icon icon-iRView-2"></i><em>mVideoTracker</em><span>移动视频内容市场监测</span></a>
                            </li>
                            <li><a href="http://irv.iresearch.com.cn/iResearchDataWeb/?m=user&a=jump&pro=19"
                                   target="_blank"><i class="icon icon-iRView-3"></i><em>oVideoTracker</em><span>OTT视频内容市场监测</span></a>
                            </li>
                            <li><a href="http://irv.iresearch.com.cn/iResearchDataWeb/?m=user&a=jump&pro=31"
                                   target="_blank"><i
                                            class="icon icon-iRView-4"></i><em>iKOLTracker</em><span>意见领袖市场监测</span></a>
                            </li>
                            <li><a href="http://irv.iresearch.com.cn/iResearchDataWeb/?m=user&a=jump&pro=12"
                                   target="_blank"><i class="icon icon-iRView-5"></i><em>iUserTracker</em><span>PC端用户行为监测</span></a>
                            </li>
                            <li><a href="http://irv.iresearch.com.cn/iResearchDataWeb/?m=user&a=jump&pro=37"
                                   target="_blank"><i class="icon icon-iRView-6"></i><em>mUserTracker</em><span>移动端用户行为监测</span></a>
                            </li>

                        </ul>
                    </div>
                </li>
                <li id="n_4"><a href="//irv.iresearch.com.cn/iResearchDataWeb/iRCloud.shtml"><span>艾瑞智云</span><em>iRCloud</em></a></li>
                <li id="n_5" role="presentation" class="dropdown">
                    <a href="//irv.iresearch.com.cn/iResearchDataWeb/About.shtml" class="dropdown-toggle"><span>关于我们</span><em>About Us</em></a>
                    <div class="dropdown-menu-box">
                        <ul class="dropdown-menu">
                            <li><a href="//irv.iresearch.com.cn/iResearchDataWeb/About.shtml"><span>联系我们</span><em>Contact Us</em></a></li>
                            <li><a href="http://group.iresearch.com.cn/" target="_blank"><span>艾瑞集团</span><em>iResearch
                                        Group</em></a></li>
                        </ul>
                    </div>
                </li>
            </ul>
        </div>
    </div>
</nav>
<div class="clearfix"></div>
<!--导航 end-->
<div class="container" id="search">
    <h5 class="bread"><span class="glyphicon glyphicon-menu-left" aria-hidden="true"></span> 返回视频内容首页</h5>
    <div class="search-content">
        <h3>视频内容搜索结果</h3>
        <div class="input-group input-group-lg">
            <input v-model="searchVal" class="form-control" placeholder="请输入视频内容查询" @keyup.enter="searchBtn(searchVal)">
            <span class="input-group-btn" @click="searchBtn(searchVal)">
          <button class="btn btn-default" type="button">
          <span class="ivu-icon ivu-icon-search"></span>
        </button>
        </span>
        </div>
    </div>
    <div class="menu">
        <ul>
            <li>
                <Radio-group v-model="dateTypeVal" type="button" @on-change="changeDateType">
                    <Radio v-for="date in dateTypeItem" :label="date.value" :value="date.value" :key="date.value"
                           v-cloak>[[ date.label ]]
                    </Radio>
                </Radio-group>
            </li>
            <li>
                <i-select v-model="dateVal" style="width:150px" @on-change="changeDate">
                    <i-option v-for="item in dateList" :value="item.data_value" :key="item.data_value"
                              :label="item.label" v-cloak>[[ item.label ]]
                    </i-option>
                </i-select>
            </li>
            <li>指标:</li>
            <li>
                <i-select v-model="indexVal" style="width:150px" @on-change="changeIndex">
                    <i-option v-for="item in indexItem" :value="item.value" :key="item.value" :label="item.label"
                              v-cloak>[[ item.label ]]
                    </i-option>
                </i-select>
            </li>
            <li>频道:</li>
            <li>
                <i-select v-model="channelVal" style="width:150px" @on-change="changeChannel">
                    <i-option v-for="item in channelItem" :value="item.value" :key="item" v-cloak>[[ item.label ]]
                    </i-option>
                </i-select>
            </li>
            <li>
                <i-button type="primary" @click="exportData">导出数据</i-button>
            </li>
        </ul>
    </div>
    <div class="table-content">
        <i-table v-show="!loading" :columns="columns" :data="table" ref="table"></i-table>
        <Spin size="large" fix v-if="loading"></Spin>
    </div>
</div>
<script src="http://data.iresearch.com.cn/js/jquery.min.js"></script>
<script src="http://data.iresearch.com.cn/js/bootstrap.min.js"></script>
<link href="public/css/xvt/iview.css" rel="stylesheet">
<script src="https://cdn.bootcss.com/vue/2.3.4/vue.min.js"></script>
<script src="https://cdn.bootcss.com/iview/2.0.0-rc.18/iview.min.js"></script>
<script src="public/js/header.js"></script>
<script>
    var getQuery = function (name) {
        'use strict';
        var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)");
        var r = window.location.search.substr(1).match(reg);
        if (r != null) {
            return unescape(encodeURIComponent(r[2]));
        }
        return null;
    };
    new Vue({
        delimiters: ["[[", "]]"],
        el: '#search',
        data: {
            loading: false,
            searchVal: decodeURIComponent(getQuery('key')),
            dateTypeVal: 'month',
            dateTypeItem: [{
                value: 'month',
                label: '月'
            },
                {
                    value: 'weekly',
                    label: '周'
                },
                {
                    value: 'daily',
                    label: '日'
                }
            ],
            indexItem: [{
                value: 'uv',
                label: '设备数'
            },
                {
                    value: 'pv',
                    label: '播放量'
                },
                {
                    value: 'playtime',
                    label: '播放时长'
                }
            ],
            channelItem: [{
                value: 'all',
                label: '全部'
            },
                {
                    value: '电影',
                    label: '电影'
                },
                {
                    value: '电视剧',
                    label: '电视剧'
                },
                {
                    value: '综艺',
                    label: '综艺'
                },
                {
                    value: '动漫',
                    label: '动漫'
                }
            ],
            indexVal: 'uv',
            channelVal: 'all',
            dateList: [],
            dateVal: '',
            table: [],
            columns: [{
                type: 'index',
                width: 80,
                align: 'center',
                title: '序号'
            }, {
                align: 'left',
                width: 400,
                title: '视频内容',
                key: 'tv_name',
            }, {
                align: 'left',
                width: 100,
                title: '频道',
                key: 'channel'
            }, {
                align: 'right',
                title: '合计',
                key: 'sum',
                sortable: true
            }, {
                align: 'right',
                title: '移动端',
                key: 'mvt',
                sortable: true,
                render: function (el, data) {
                    if (data.row.hasToken) {
                        return el('Button', {
                            props: {
                                type: 'text',
                                size: 'small'
                            },
                            style: {
                                marginRight: '5px'
                            },
                            on: {
                                click: function () {
                                    location.href = data.row.mvtURL;
                                }
                            }
                        }, data.row.mvt)
                    } else {
                        return data.row.mvt;
                    }
                }
            }, {
                align: 'right',
                title: 'PC端',
                key: 'ivt',
                sortable: true,
                render: function (el, data) {
                    if (data.row.hasToken) {
                        return el('Button', {
                            props: {
                                type: 'text',
                                size: 'small'
                            },
                            style: {
                                marginRight: '5px'
                            },
                            on: {
                                click: function () {
                                    location.href = data.row.ivtURL;
                                }
                            }
                        }, data.row.ivt)
                    } else {
                        return data.row.ivt;
                    }
                }
            }, {
                align: 'right',
                title: 'OTT端',
                key: 'ovt',
                sortable: true,
                render: function (el, data) {
                    if (data.row.hasToken) {
                        return el('Button', {
                            props: {
                                type: 'text',
                                size: 'small'
                            },
                            style: {
                                marginRight: '5px'
                            },
                            on: {
                                click: function () {
                                    location.href = data.row.ovtURL;
                                }
                            }
                        }, data.row.ovt)
                    } else {
                        return data.row.ovt;
                    }
                }
            }],
            count: 0
        },
        created() {
            this.fetchDate()
        },
        methods: {
            fetchDate: function () {
                var self = this;
                var params = {
                    type: self.dateTypeVal
                }
                $.ajax({
                    url: '//localhost/xmpapi/public/api/xvt/getDate',
                    type: 'POST',
                    data: JSON.stringify(params),
                    dataType: 'json',
                    success: function (res) {
                        self.dateList = res.data;
                        self.dateVal = res.data[0].data_value;
                        if (self.dateVal) {
                            self.fetchTable();
                        }
                    }
                })
            },
            fetchTable: function () {
                var self = this;
                self.loading = true;
                var params = {
                    keyWord: self.searchVal,
                    dateZone: self.dateTypeVal,
                    date: self.dateVal,
                    key: self.indexVal,
                    channel: self.channelVal,
                    orderBy: 'desc',
                    orderKey: 'mvt'
                }
                self.table = [];
                $.ajax({
//                    url: '//localhost/xmpapi/public/api/xvt/search',
                    url: '//localhost/iData/?m=index&a=xvtSearchAPI',
                    type: 'POST',
                    data: JSON.stringify(params),
                    dataType: 'json',
                    success: function (res) {
                        self.table = res.data;
                        self.loading = false;
                    }
                })
            },
            changeDateType: function (val) {
                var self = this;
                self.dateTypeVal = val;
                var params = {
                    type: self.dateTypeVal
                }
                $.ajax({
                    url: '//localhost/xmpapi/public/api/xvt/getDate',
                    type: 'POST',
                    data: JSON.stringify(params),
                    dataType: 'json',
                    success: function (res) {
                        self.dateList = res.data;
                        self.dateVal = res.data[0].data_value;
                    }
                })
            },
            searchBtn: function (val) {
                this.searchVal = val;
                this.fetchDate();
            },
            changeDate: function (val) {
                this.dateVal = val;
                this.count++;
                if (this.count > 1) {
                    this.fetchTable();
                }
            },
            changeIndex: function (val) {
                this.indexVal = val;
                this.fetchTable();
            },
            changeChannel: function (val) {
                this.channelVal = val;
                this.fetchTable();
            },
            exportData: function () {
                this.$refs.table.exportCsv({
                    filename: this.searchVal,
                    columns: this.columns.splice(this.columns[0], 1)
                });
            }
        }
    })
</script>
</body>

</html>